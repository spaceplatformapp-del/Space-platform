<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Space</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-512.png">
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Space">

  <style>
    :root{
      --bg:#f0f2f5;--card:#ffffff;--text:#050505;--muted:#65676b;
      --primary:#1b74e4;--secondary:#e4405f;--accent:#8b5cf6;
      --gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --hover:#f2f3f5;
    }
    .dark{
      --bg:#18191a;--card:#242526;--text:#e4e6eb;--muted:#b0b3b8;
      --primary:#2d88ff;--secondary:#ff6b9d;--hover:#3a3b3c;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body,#root{height:100%;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:680px;margin:0 auto;padding:12px 12px 80px}
    .card{background:var(--card);border-radius:8px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,0.2);margin-bottom:12px}
    .card-lg{padding:20px}
    .row{display:flex;gap:12px;align-items:center}
    .col{display:flex;flex-direction:column;gap:12px}
    .btn{background:var(--primary);color:#fff;padding:10px 24px;border-radius:6px;border:none;cursor:pointer;font-weight:600;font-size:15px}
    .btn:hover{opacity:0.9}
    .btn-secondary{background:var(--hover);color:var(--text)}
    .btn-ghost{background:var(--hover);color:var(--text);padding:8px 16px;border-radius:6px;cursor:pointer;border:none;font-weight:600}
    input,textarea,select{padding:12px;border:1px solid #ccd0d5;border-radius:6px;width:100%;background:var(--card);color:var(--text);font-size:15px}
    input:focus,textarea:focus{outline:none;border-color:var(--primary)}
    textarea{min-height:80px;resize:vertical;font-family:inherit}
    .small{font-size:13px;color:var(--muted)}
    .avatar{width:40px;height:40px;border-radius:50%;object-fit:cover}
    .avatar-lg{width:48px;height:48px}
    .story-circle{width:110px;min-width:110px;height:150px;border-radius:12px;overflow:hidden;cursor:pointer;position:relative;border:3px solid var(--card);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
    .story-circle img{width:100%;height:100%;object-fit:cover}
    .story-avatar{position:absolute;top:8px;left:8px;width:40px;height:40px;border-radius:50%;border:4px solid var(--primary)}
    .story-label{position:absolute;bottom:8px;left:8px;right:8px;color:#fff;font-weight:600;font-size:13px;text-shadow:0 1px 2px rgba(0,0,0,0.5)}
    .badge{background:var(--gradient);color:#fff;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;margin-left:6px}
    .notif-badge{position:absolute;top:-4px;right:-4px;background:#fa3e3e;color:#fff;border-radius:50%;min-width:20px;height:20px;padding:0 6px;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:700;border:2px solid var(--card)}
    .post-media{width:100%;max-height:600px;border-radius:8px;margin-top:12px;object-fit:cover}
    .cover{height:200px;background:var(--gradient);border-radius:8px 8px 0 0;object-fit:cover;width:100%}
    .splash{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column}
    .splash .logo{font-size:72px;font-weight:900;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    .topbar{position:sticky;top:0;background:var(--card);border-bottom:1px solid #ccd0d5;padding:8px 16px;display:flex;align-items:center;gap:12px;z-index:100;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
    .topbar-logo{font-size:32px;font-weight:900;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;cursor:pointer;width:40px}
    .search-box{flex:1;max-width:240px;position:relative}
    .search-input{padding:10px 16px;border-radius:50px;background:var(--hover);border:none;font-size:15px}
    .search-results{position:absolute;top:100%;left:0;right:0;background:var(--card);border-radius:8px;margin-top:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);max-height:400px;overflow-y:auto;z-index:200}
    .search-item{padding:12px;cursor:pointer;border-bottom:1px solid var(--hover)}
    .search-item:hover{background:var(--hover)}
    .topbar-icons{display:flex;gap:8px}
    .icon-btn{width:40px;height:40px;border-radius:50%;background:var(--hover);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;font-size:20px}
    .icon-btn:hover{background:#e4e6eb}
    .dark .icon-btn:hover{background:#4a4b4d}
    .bottomnav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid #ccd0d5;display:flex;justify-content:space-around;padding:6px 0;z-index:100;box-shadow:0 -2px 4px rgba(0,0,0,0.1)}
    .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;padding:8px;border-radius:8px;margin:0 4px}
    .nav-item:hover{background:var(--hover)}
    .nav-item.active{color:var(--primary)}
    .nav-item.active .nav-icon{border-bottom:3px solid var(--primary)}
    .nav-icon{font-size:24px;padding:4px 0}
    .nav-label{font-size:12px;font-weight:500}
    .composer-trigger{background:var(--hover);padding:12px 16px;border-radius:50px;color:var(--muted);cursor:pointer;width:100%;text-align:left;border:none;font-size:15px}
    .composer-trigger:hover{background:#e4e6eb}
    .dark .composer-trigger:hover{background:#3a3b3c}
    .like-btn{display:inline-flex;align-items:center;gap:8px;cursor:pointer;padding:8px 12px;border-radius:6px;transition:all 0.2s;font-weight:600;color:var(--muted)}
    .like-btn:hover{background:var(--hover)}
    .like-btn.liked{color:#e4405f}
    .comment-section{margin-top:12px;padding-top:12px;border-top:1px solid var(--hover)}
    .comment-item{background:var(--hover);padding:10px 12px;border-radius:16px;margin-bottom:8px}
    .comment-author{font-weight:600;font-size:13px;margin-bottom:4px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px}
    .modal-content{background:var(--card);border-radius:12px;padding:24px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,0.3)}
    .tabs{display:flex;border-bottom:1px solid var(--hover);margin-bottom:16px}
    .tab{padding:14px 20px;cursor:pointer;color:var(--muted);font-weight:600;border-bottom:3px solid transparent}
    .tab.active{color:var(--primary);border-bottom-color:var(--primary)}
    .friend-card{display:flex;align-items:center;justify-content:space-between;padding:12px;background:var(--card);border-radius:8px;margin-bottom:8px}
    .empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
    .empty-icon{font-size:64px;margin-bottom:16px;opacity:0.5}
    #space-diagnostics{position:fixed;left:8px;right:8px;top:8px;padding:12px;background:#fff3cd;border:2px solid #ffc107;border-radius:8px;z-index:99999;display:none;box-shadow:0 4px 12px rgba(0,0,0,0.15)}
  </style>

  <script>
  window.SPACE_CONFIG = {
    firebaseConfig: {
      apiKey: "AIzaSyCa4goO5GkfV3P2xlxCGcBpbsbKf43zCrE",
      authDomain: "space-platform-app.firebaseapp.com",
      projectId: "space-platform-app",
      storageBucket: "space-platform-app.firebasestorage.app",
      messagingSenderId: "43015155483",
      appId: "43015155483:web:5a14764017a03001f3edbe"
    },
    cloudinary: {
      cloudName: "drfvrs2yi",
      uploadPreset: "Spaceuploads"
    },
    ADMIN_EMAIL: "spaceplatformapp@gmail.com"
  };
  </script>

</head>
<body>
  <div id="space-diagnostics">
    <b>‚ö†Ô∏è Space Diagnostic</b>
    <div id="space-diagnostics-msg" style="margin-top:8px;font-size:13px"></div>
    <button id="space-diagnostics-clear" style="margin-top:8px;padding:6px 12px;border:none;background:#1b74e4;color:white;border-radius:6px;cursor:pointer">Hide</button>
  </div>
  <script>
    (function(){
      const box = document.getElementById('space-diagnostics');
      const msg = document.getElementById('space-diagnostics-msg');
      const btn = document.getElementById('space-diagnostics-clear');
      btn.onclick = ()=> box.style.display='none';
      function showError(e){
        box.style.display = 'block';
        const text = (typeof e === 'string') ? e : (e && (e.message || e.stack)) || 'Unknown error';
        msg.innerText = text;
        console.error('Space diagnostic:', e);
      }
      window.addEventListener('error', (ev)=> { showError(ev.error || ev.message); });
      window.addEventListener('unhandledrejection', (ev)=> { showError('Promise rejection: ' + (ev.reason?.message || ev.reason)); });
      window.SPACE_APP_OK = ()=> { box.style.display='block'; msg.innerText='‚úÖ App loaded!'; setTimeout(()=> box.style.display='none', 2000); };
    })();
  </script>

  <div id="splash" class="splash">
    <div class="logo">S</div>
    <div style="font-size:28px;font-weight:700;margin-top:12px">Space</div>
    <div class="small" style="margin-top:8px">Loading...</div>
  </div>

  <div id="root" style="visibility:hidden"></div>

  <script type="module">
  import React, { useEffect, useState, useRef } from 'https://cdn.jsdelivr.net/npm/react@18.2.0/+esm';
  import { createRoot } from 'https://cdn.jsdelivr.net/npm/react-dom@18.2.0/+esm';
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendEmailVerification, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getFirestore, collection, doc, setDoc, getDoc, addDoc, query, where, getDocs, orderBy, onSnapshot, updateDoc, deleteDoc, serverTimestamp, arrayUnion, arrayRemove, limit } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  import { getStorage } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

  const CONFIG = window.SPACE_CONFIG || {};
  const app = initializeApp(CONFIG.firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const CLOUDINARY_CLOUD = CONFIG.cloudinary?.cloudName || "";
  const CLOUDINARY_UPLOAD_PRESET = CONFIG.cloudinary?.uploadPreset || "";
  const ADMIN_EMAIL = CONFIG.ADMIN_EMAIL || "";

  async function uploadToCloudinary(file) {
    if (!CLOUDINARY_CLOUD || !CLOUDINARY_UPLOAD_PRESET) throw new Error('Cloudinary not configured');
    const typeSegment = file.type.startsWith('video') ? 'video' : 'image';
    const url = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD}/${typeSegment}/upload`;
    const form = new FormData();
    form.append('file', file);
    form.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
    const res = await fetch(url, { method: 'POST', body: form });
    return res.json();
  }

  async function createUserProfile(uid, profile) {
    await setDoc(doc(db, 'users', uid), { ...profile, bio: '', status: '', createdAt: serverTimestamp() });
  }
  async function getUserProfile(uid) {
    const d = await getDoc(doc(db, 'users', uid));
    return d.exists() ? { id: d.id, ...d.data() } : null;
  }
  async function searchUsers(term) {
    if (!term || term.length < 2) return [];
    const q = query(collection(db, 'users'), where('displayNameLower', '>=', term.toLowerCase()), orderBy('displayNameLower'), limit(10));
    const snap = await getDocs(q);
    return snap.docs.map(d => ({ id: d.id, ...d.data() }));
  }

  async function createPost(post) { return addDoc(collection(db, 'posts'), { ...post, likes: [], comments: [], createdAt: serverTimestamp() }); }
  function subscribeFeed(cb) { const q = query(collection(db, 'posts'), orderBy('createdAt','desc')); return onSnapshot(q, snap => cb(snap.docs.map(d=>({ id: d.id, ...d.data() })))); }
  async function updatePost(postId, data) { return updateDoc(doc(db,'posts',postId), data); }
  async function deletePost(postId) { return deleteDoc(doc(db,'posts',postId)); }
  async function toggleLike(postId, uid) {
    const postRef = doc(db, 'posts', postId);
    const postSnap = await getDoc(postRef);
    if (!postSnap.exists()) return;
    const likes = postSnap.data().likes || [];
    if (likes.includes(uid)) {
      await updateDoc(postRef, { likes: arrayRemove(uid) });
    } else {
      await updateDoc(postRef, { likes: arrayUnion(uid) });
    }
  }
  async function addComment(postId, uid, text) {
    const postRef = doc(db, 'posts', postId);
    await updateDoc(postRef, { comments: arrayUnion({ uid, text, createdAt: new Date().toISOString() }) });
  }

  async function createStory(uid, mediaUrl, mediaType) { 
    const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);
    return addDoc(collection(db, 'stories'), { uid, mediaUrl, mediaType, createdAt: serverTimestamp(), expiresAt: expiresAt.toISOString() }); 
  }
  function subscribeStories(cb) { 
    const q = query(collection(db, 'stories'), orderBy('createdAt','desc')); 
    return onSnapshot(q, snap => {
      const now = new Date();
      const active = snap.docs.map(d=>({ id: d.id, ...d.data() })).filter(s => {
        if (!s.expiresAt) return true;
        return new Date(s.expiresAt) > now;
      });
      cb(active);
    }); 
  }

  async function sendFriendRequest(from, to) { 
    const id = `${from}_${to}`;
    await setDoc(doc(db, 'friends', id), { requester: from, target: to, status: 'pending', createdAt: serverTimestamp() });
  }
  async function acceptFriendRequest(requestId) {
    await updateDoc(doc(db, 'friends', requestId), { status: 'accepted' });
  }
  async function declineFriendRequest(requestId) {
    await deleteDoc(doc(db, 'friends', requestId));
  }
  async function getFriendRequests(uid) {
    const q = query(collection(db, 'friends'), where('target', '==', uid), where('status', '==', 'pending'));
    const snap = await getDocs(q);
    return snap.docs.map(d => ({ id: d.id, ...d.data() }));
  }
  async function getFriends(uid) {
    const q = query(collection(db, 'friends'), where('status', '==', 'accepted'));
    const snap = await getDocs(q);
    return snap.docs.map(d => d.data()).filter(f => f.requester === uid || f.target === uid);
  }

  async function sendMessage(chatId, from, text, media=null) { 
    await addDoc(collection(db, `chats/${chatId}/messages`), { from, text, media, read: false, createdAt: serverTimestamp() }); 
    await setDoc(doc(db, 'chats', chatId), { participants: chatId.split('_'), lastMessage: text, updatedAt: serverTimestamp() }, { merge: true });
  }
  function subscribeMessages(chatId, cb) { 
    const q = query(collection(db, `chats/${chatId}/messages`), orderBy('createdAt','asc')); 
    return onSnapshot(q, snap => cb(snap.docs.map(d=>({ id: d.id, ...d.data() })))); 
  }

  function fmtDate(ts) {
    if (!ts) return '';
    try {
      const date = ts.seconds ? new Date(ts.seconds*1000) : new Date(ts);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);
      if (diff < 60) return 'Just now';
      if (diff < 3600) return `${Math.floor(diff/60)}m`;
      if (diff < 86400) return `${Math.floor(diff/3600)}h`;
      return date.toLocaleDateString();
    } catch { return ''; }
  }
  function App() {
    const [user, setUser] = useState(null);
    const [page, setPage] = useState('loading');
    const [feed, setFeed] = useState([]);
    const [stories, setStories] = useState([]);
    const [theme, setTheme] = useState(localStorage.getItem('theme') || 'light');
    const [lang, setLang] = useState(localStorage.getItem('lang') || 'en');
    const [searchTerm, setSearchTerm] = useState('');
    const [searchResults, setSearchResults] = useState([]);
    const [selectedProfile, setSelectedProfile] = useState(null);
    const [userProfile, setUserProfile] = useState(null);
    const [showComposer, setShowComposer] = useState(false);
    const [showForgot, setShowForgot] = useState(false);

    useEffect(()=> {
      const splash = document.getElementById('splash');
      onAuthStateChanged(auth, async (u) => {
        setUser(u);
        if (u) {
          const prof = await getUserProfile(u.uid);
          setUserProfile(prof);
          if (!prof) setPage('register'); 
          else setPage('home');
        } else {
          setPage('login');
        }
      });
      const unsubFeed = subscribeFeed(setFeed);
      const unsubStories = subscribeStories(setStories);
      setTimeout(()=> {
        if (splash) splash.style.display = 'none';
        document.getElementById('root').style.visibility = 'visible';
        if (window.SPACE_APP_OK) window.SPACE_APP_OK();
      }, 800);
      return ()=> { unsubFeed(); unsubStories(); };
    }, []);

    useEffect(()=> { 
      document.documentElement.classList.toggle('dark', theme === 'dark'); 
      localStorage.setItem('theme', theme); 
    }, [theme]);
    
    useEffect(()=> {
      const timeout = setTimeout(async ()=> {
        if (searchTerm.length >= 2) { 
          const r = await searchUsers(searchTerm); 
          setSearchResults(r); 
        } else setSearchResults([]);
      }, 300);
      return ()=> clearTimeout(timeout);
    }, [searchTerm]);

    if (!user && (page === 'login' || page === 'register')) {
      return React.createElement('div', { className: 'container' },
        page === 'login' && React.createElement(LoginPage, { onSuccess: () => setPage('home'), onSwitch: () => setPage('register'), onForgot: () => setShowForgot(true) }),
        page === 'register' && React.createElement(RegisterPage, { onSuccess: () => setPage('home'), onSwitch: () => setPage('login') }),
        showForgot && React.createElement(ForgotModal, { onClose: () => setShowForgot(false) })
      );
    }

    return React.createElement('div', null,
      React.createElement(TopBar, { user, userProfile, searchTerm, setSearchTerm, searchResults, onNav: setPage, onOpenProfile: uid => { setSelectedProfile(uid); setPage('profile'); }}),
      React.createElement('div', { className: 'container' },
        page === 'loading' && React.createElement('div', { className: 'card' }, 'Loading...'),
        page === 'home' && React.createElement(HomePage, { user, feed, stories, showComposer, setShowComposer }),
        page === 'friends' && React.createElement(FriendsPage, { user }),
        page === 'profile' && React.createElement(ProfilePage, { uid: selectedProfile || (user && user.uid), currentUser: user }),
        page === 'messages' && React.createElement(MessagesPage, { currentUser: user }),
        page === 'settings' && React.createElement(SettingsPage, { lang, setLang, theme, setTheme }),
        page === 'admin' && userProfile && userProfile.verified && React.createElement(AdminPage, null)
      ),
      user && React.createElement(BottomNav, { page, setPage, userProfile })
    );
  }

  function TopBar({ user, userProfile, searchTerm, setSearchTerm, searchResults, onNav, onOpenProfile }) {
    return React.createElement('div', { className: 'topbar' },
      React.createElement('div', { className: 'topbar-logo', onClick: () => onNav('home') }, 'S'),
      user && React.createElement('div', { className: 'search-box' },
        React.createElement('input', { className: 'search-input', placeholder: 'üîç Search...', value: searchTerm, onInput: e => setSearchTerm(e.target.value) }),
        searchResults.length > 0 && React.createElement('div', { className: 'search-results' },
          searchResults.map(s => React.createElement('div', { key: s.id, className: 'search-item', onClick: () => { onOpenProfile(s.id); setSearchTerm(''); }},
            React.createElement('div', { className: 'row' },
              s.avatarUrl && React.createElement('img', { src: s.avatarUrl, className: 'avatar' }),
              React.createElement('div', null,
                React.createElement('div', { style: { fontWeight:600 } }, s.displayName),
                s.verified && React.createElement('span', { 
                  title: 'Verified', 
                  style: { marginLeft: 6, verticalAlign: 'middle' }, 
                  dangerouslySetInnerHTML: { 
                    __html: '<svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:#1D9BF0" xmlns="http://www.w3.org/2000/svg"><path d="M22.5 12.5c0-.9-.3-1.7-.8-2.4.3-.8.4-1.6.2-2.4-.2-.8-.7-1.5-1.3-2-.6-.5-1.4-.8-2.2-.9-.3-.7-.8-1.4-1.5-1.9-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7.5-1.2 1.2-1.5 1.9-.8.1-1.6.4-2.2.9-.6.5-1.1 1.2-1.3 2-.2.8-.1 1.6.2 2.4-.5.7-.8 1.5-.8 2.4s.3 1.7.8 2.4c-.3.8-.4 1.6-.2 2.4.2.8.7 1.5 1.3 2 .6.5 1.4.8 2.2.9.3.7.8 1.4 1.5 1.9.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7-.5 1.2-1.2 1.5-1.9.8-.1 1.6-.4 2.2-.9.6-.5 1.1 1.2-1.3 2 .2-.8.1-1.6-.2-2.4.5-.7.8-1.5.8-2.4z"/><path fill="#fff" d="M10.8 14.9l-2.8-2.8 1.2-1.2 1.6 1.6 3.7-4 1.2 1.1z"/></svg>' 
                  }
                })
              )
            )
          ))
        )
      ),
      user && React.createElement('div', { className: 'topbar-icons' },
        React.createElement('div', { className: 'icon-btn', onClick: () => onNav('notifications') }, 'üîî'),
        userProfile?.avatarUrl && React.createElement('img', { src: userProfile.avatarUrl, className: 'avatar', onClick: () => onNav('profile'), style: { cursor:'pointer' }})
      )
    );
  }

  function BottomNav({ page, setPage, userProfile }) {
    return React.createElement('div', { className: 'bottomnav' },
      ['home','friends','messages','profile','settings'].map(p => 
        React.createElement('div', { key: p, className: `nav-item ${page === p ? 'active' : ''}`, onClick: () => setPage(p) },
          React.createElement('div', { className: 'nav-icon' }, 
            p === 'home' ? 'üè†' : p === 'friends' ? 'üë•' : p === 'messages' ? 'üí¨' : p === 'profile' ? 'üë§' : '‚öôÔ∏è'
          ),
          React.createElement('div', { className: 'nav-label' }, p.charAt(0).toUpperCase() + p.slice(1))
        )
      )
    );
  }

  function LoginPage({ onSuccess, onSwitch, onForgot }) {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [msg, setMsg] = useState('');
    async function submit(e) {
      e?.preventDefault();
      setMsg('');
      try { 
        await signInWithEmailAndPassword(auth, email, password); 
        onSuccess();
      } catch (err) { 
        setMsg(err.message);
      }
    }
    return React.createElement('div', { className: 'card card-lg', style: { maxWidth:400, margin:'60px auto' }},
      React.createElement('h1', { style: { textAlign:'center', background:'var(--gradient)', WebkitBackgroundClip:'text', WebkitTextFillColor:'transparent', marginBottom:24 }}, 'Space'),
      React.createElement('form', { onSubmit: submit, className: 'col' },
        React.createElement('input', { placeholder: 'Email', type: 'email', value: email, onInput: e => setEmail(e.target.value), required: true }),
        React.createElement('input', { placeholder: 'Password', type: 'password', value: password, onInput: e => setPassword(e.target.value), required: true }),
        React.createElement('button', { className: 'btn', type: 'submit', style: { width:'100%' }}, 'Log In'),
        React.createElement('a', { href: '#', onClick: e => { e.preventDefault(); onForgot(); }, style: { textAlign:'center', fontSize:14, color:'var(--primary)' }}, 'Forgot password?'),
        msg && React.createElement('div', { style: { color:'#fa3e3e', fontSize:14, textAlign:'center' }}, msg)
      ),
      React.createElement('div', { style: { textAlign:'center', marginTop:20, paddingTop:20, borderTop:'1px solid var(--hover)' }},
        React.createElement('button', { className: 'btn-secondary', onClick: onSwitch, style: { padding:'10px 24px', borderRadius:6 }}, 'Create Account')
      )
    );
  }

  function RegisterPage({ onSuccess, onSwitch }) {
    const [form, setForm] = useState({ name:'', dob:'', gender:'', email:'', password:'' });
    const [error, setError] = useState('');
    async function submit(e) {
      e?.preventDefault();
      setError('');
      try {
        const cred = await createUserWithEmailAndPassword(auth, form.email, form.password);
        const isAdmin = form.email.toLowerCase() === ADMIN_EMAIL.toLowerCase();
        await createUserProfile(cred.user.uid, {
          displayName: form.name,
          displayNameLower: form.name.toLowerCase(),
          dob: form.dob,
          gender: form.gender,
          email: form.email,
          avatarUrl: null,
          coverUrl: null,
          verified: isAdmin
        });
        if (ADMIN_EMAIL && !isAdmin) {
          const q = query(collection(db,'users'), where('email','==',ADMIN_EMAIL));
          const snap = await getDocs(q);
          if (!snap.empty) await sendFriendRequest(cred.user.uid, snap.docs[0].id);
        }
        try { await sendEmailVerification(cred.user); } catch(e){}
        alert('‚úÖ Account created!');
        onSuccess();
      } catch (err) { 
        setError(err.message);
      }
    }
    return React.createElement('div', { className: 'card card-lg', style: { maxWidth:400, margin:'40px auto' }},
      React.createElement('h2', { style: { textAlign:'center', marginBottom:24 }}, 'Sign Up'),
      React.createElement('form', { onSubmit: submit, className: 'col' },
        React.createElement('input', { placeholder: 'Full name', value: form.name, onInput: e => setForm({...form, name: e.target.value}), required: true }),
        React.createElement('input', { type: 'date', value: form.dob, onInput: e => setForm({...form, dob: e.target.value}), required: true }),
        React.createElement('select', { value: form.gender, onChange: e => setForm({...form, gender: e.target.value}), required: true },
          React.createElement('option', { value: '' }, 'Gender'),
          React.createElement('option', { value: 'male' }, 'Male'),
          React.createElement('option', { value: 'female' }, 'Female'),
          React.createElement('option', { value: 'other' }, 'Other')
        ),
        React.createElement('input', { placeholder: 'Email', type: 'email', value: form.email, onInput: e => setForm({...form, email: e.target.value}), required: true }),
        React.createElement('input', { placeholder: 'Password', type: 'password', value: form.password, onInput: e => setForm({...form, password: e.target.value}), required: true }),
        React.createElement('button', { className: 'btn', type: 'submit', style: { width:'100%' }}, 'Sign Up'),
        error && React.createElement('div', { style: { color:'#fa3e3e', fontSize:14, textAlign:'center' }}, error)
      ),
      React.createElement('div', { style: { textAlign:'center', marginTop:20 }},
        React.createElement('a', { href: '#', onClick: e => { e.preventDefault(); onSwitch(); }, style: { color:'var(--primary)' }}, 'Already have an account?')
      )
    );
  }

  function ForgotModal({ onClose }) {
    const [email, setEmail] = useState('');
    const [msg, setMsg] = useState('');
    async function submit(e) {
      e?.preventDefault();
      try {
        await sendPasswordResetEmail(auth, email);
        setMsg('‚úÖ Reset link sent!');
        setTimeout(onClose, 2000);
      } catch (err) {
        setMsg('‚ùå ' + err.message);
      }
    }
    return React.createElement('div', { className: 'modal', onClick: onClose },
      React.createElement('div', { className: 'modal-content', onClick: e => e.stopPropagation() },
        React.createElement('h3', { style: { marginBottom:20 }}, 'Reset Password'),
        React.createElement('form', { onSubmit: submit, className: 'col' },
          React.createElement('input', { placeholder: 'Enter email', type: 'email', value: email, onInput: e => setEmail(e.target.value), required: true }),
          React.createElement('div', { className: 'row', style: { gap:12 }},
            React.createElement('button', { className: 'btn', type: 'submit', style: { flex:1 }}, 'Send'),
            React.createElement('button', { className: 'btn-ghost', type: 'button', onClick: onClose, style: { flex:1 }}, 'Cancel')
          ),
          msg && React.createElement('div', { style: { textAlign:'center', marginTop:12 }}, msg)
        )
      )
    );
  }

  function HomePage({ user, feed, stories, showComposer, setShowComposer }) {
    return React.createElement('div', null,
      React.createElement('div', { className: 'card' },
        React.createElement('div', { className: 'row', style: { alignItems:'flex-start', gap:16 }},
          React.createElement('div', { className: 'avatar-lg', style: { background:'var(--gradient)', flexShrink:0 }}),
          React.createElement('button', { className: 'composer-trigger', onClick: () => setShowComposer(true), style: { flex:1 }}, "What's on your mind?")
        )
      ),
      React.createElement('div', { className: 'card', style: { padding:'16px 12px' }},
        React.createElement('div', { className: 'row', style: { overflowX:'auto', gap:12, paddingBottom:8 }},
          React.createElement(StoryComposer, { user }),
          stories.slice(0,5).map(s => React.createElement(StoryCard, { key: s.id, story: s }))
        )
      ),
      showComposer && React.createElement(ComposerModal, { user, onClose: () => setShowComposer(false) }),
      feed.length === 0 && React.createElement('div', { className: 'empty-state' },
        React.createElement('div', { className: 'empty-icon' }, 'üìù'),
        React.createElement('div', null, 'No posts yet')
      ),
      feed.map(p => React.createElement(PostCard, { key: p.id, post: p, currentUser: user }))
    );
  }

  function StoryComposer({ user }) {
    const fileInput = useRef(null);
    const [loading, setLoading] = useState(false);
    async function handleFile(e) {
      const file = e.target.files?.[0];
      if (!file) return;
      setLoading(true);
      try {
        const res = await uploadToCloudinary(file);
        await createStory(user.uid, res.secure_url, res.resource_type || 'image');
      } catch { alert('‚ùå Upload failed'); } finally { setLoading(false); }
    }
    return React.createElement('div', { className: 'story-circle', onClick: () => fileInput.current?.click(), style: { background:'var(--hover)', display:'flex', alignItems:'center', justifyContent:'center', flexDirection:'column' }},
      React.createElement('input', { ref: fileInput, type: 'file', accept: 'image/*,video/*', onChange: handleFile, style: { display:'none' }}),
      React.createElement('div', { style: { fontSize:32 }}, loading ? '‚è≥' : '‚ûï'),
      React.createElement('div', { style: { fontSize:13, fontWeight:600, marginTop:8 }}, 'Create')
    );
  }

  function StoryCard({ story }) {
    const [author, setAuthor] = useState(null);
    useEffect(() => {
      (async () => {
        const prof = await getUserProfile(story.uid);
        setAuthor(prof);
      })();
    }, [story.uid]);
    return React.createElement('div', { className: 'story-circle', onClick: () => window.open(story.mediaUrl, '_blank') },
      React.createElement('img', { src: story.mediaUrl }),
      author?.avatarUrl && React.createElement('img', { src: author.avatarUrl, className: 'story-avatar' }),
      React.createElement('div', { className: 'story-label' }, author?.displayName || 'User')
    );
  }

  function ComposerModal({ user, onClose }) {
    const [text, setText] = useState('');
    const [file, setFile] = useState(null);
    const [loading, setLoading] = useState(false);
    async function submit(e) {
      e?.preventDefault();
      if (!text && !file) return;
      setLoading(true);
      try {
        let media = null;
        if (file) {
          const res = await uploadToCloudinary(file);
          media = { url: res.secure_url, type: res.resource_type || 'image' };
        }
        await createPost({ authorId: user.uid, content: text, media });
        onClose();
      } catch { alert('‚ùå Failed'); } finally { setLoading(false); }
    }
    return React.createElement('div', { className: 'modal', onClick: onClose },
      React.createElement('div', { className: 'modal-content', onClick: e => e.stopPropagation() },
        React.createElement('h3', { style: { marginBottom:20 }}, 'Create Post'),
        React.createElement('form', { onSubmit: submit, className: 'col' },
          React.createElement('textarea', { placeholder: "What's on your mind?", value: text, onInput: e => setText(e.target.value), style: { minHeight:120 }}),
          React.createElement('input', { type: 'file', accept: 'image/*,video/*', onChange: e => setFile(e.target.files?.[0]) }),
          React.createElement('div', { className: 'row', style: { gap:12 }},
            React.createElement('button', { className: 'btn', type: 'submit', disabled: loading, style: { flex:1 }}, loading ? 'Posting...' : 'Post'),
            React.createElement('button', { className: 'btn-ghost', type: 'button', onClick: onClose, style: { flex:1 }}, 'Cancel')
          )
        )
      )
    );
  }

  function PostCard({ post, currentUser }) {
    const [author, setAuthor] = useState(null);
    const [showComments, setShowComments] = useState(false);
    const [commentText, setCommentText] = useState('');
    const liked = post.likes?.includes(currentUser?.uid);
    const isMine = currentUser?.uid === post.authorId;

    useEffect(() => {
      (async () => {
        const prof = await getUserProfile(post.authorId);
        setAuthor(prof);
      })();
    }, [post.authorId]);

    async function handleLike() {
      if (!currentUser) return;
      await toggleLike(post.id, currentUser.uid);
    }

    async function submitComment() {
      if (!commentText.trim()) return;
      await addComment(post.id, currentUser.uid, commentText);
      setCommentText('');
    }

    async function handleDelete() {
      if (!confirm('Delete?')) return;
      await deletePost(post.id);
    }

    return React.createElement('div', { className: 'card' },
      React.createElement('div', { className: 'row', style: { justifyContent:'space-between', marginBottom:12 }},
        React.createElement('div', { className: 'row' },
          React.createElement('img', { src: author?.avatarUrl || 'https://via.placeholder.com/40', className: 'avatar-lg' }),
          React.createElement('div', null,
            React.createElement('div', { style: { fontWeight:600, fontSize:15 }}, 
              author?.displayName || 'User',
              author?.verified && React.createElement('span', { 
                title: 'Verified', 
                style: { marginLeft: 6, verticalAlign: 'middle' }, 
                dangerouslySetInnerHTML: { 
                  __html: '<svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:#1D9BF0" xmlns="http://www.w3.org/2000/svg"><path d="M22.5 12.5c0-.9-.3-1.7-.8-2.4.3-.8.4-1.6.2-2.4-.2-.8-.7-1.5-1.3-2-.6-.5-1.4-.8-2.2-.9-.3-.7-.8-1.4-1.5-1.9-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7.5-1.2 1.2-1.5 1.9-.8.1-1.6.4-2.2.9-.6.5-1.1 1.2-1.3 2-.2.8-.1 1.6.2 2.4-.5.7-.8 1.5-.8 2.4s.3 1.7.8 2.4c-.3.8-.4 1.6-.2 2.4.2.8.7 1.5 1.3 2 .6.5 1.4.8 2.2.9.3.7.8 1.4 1.5 1.9.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7-.5 1.2-1.2 1.5-1.9.8-.1 1.6-.4 2.2-.9.6-.5 1.1 1.2-1.3 2 .2-.8.1-1.6-.2-2.4.5-.7.8-1.5.8-2.4z"/><path fill="#fff" d="M10.8 14.9l-2.8-2.8 1.2-1.2 1.6 1.6 3.7-4 1.2 1.1z"/></svg>' 
                }
              })
            ),
            React.createElement('div', { className: 'small' }, fmtDate(post.createdAt))
          )
        ),
        isMine && React.createElement('button', { className: 'btn-ghost', onClick: handleDelete, style: { padding:'6px 12px', color:'#fa3e3e' }}, 'üóëÔ∏è')
      ),
      post.content && React.createElement('p', { style: { margin:'12px 0', fontSize:15, lineHeight:1.4 }}, post.content),
      post.media && (post.media.type?.startsWith('video') ? 
        React.createElement('video', { src: post.media.url, controls: true, className: 'post-media' }) :
        React.createElement('img', { src: post.media.url, className: 'post-media' })
      ),
      React.createElement('div', { style: { display:'flex', gap:8, marginTop:12, paddingTop:12, borderTop:'1px solid var(--hover)' }},
        React.createElement('div', { className: `like-btn ${liked ? 'liked' : ''}`, onClick: handleLike },
          React.createElement('span', { style: { fontSize:20 }}, liked ? '‚ù§Ô∏è' : 'ü§ç'),
          React.createElement('span', null, post.likes?.length || 0)
        ),
        React.createElement('div', { className: 'like-btn', onClick: () => setShowComments(!showComments) },
          React.createElement('span', { style: { fontSize:20 }}, 'üí¨'),
          React.createElement('span', null, post.comments?.length || 0)
        )
      ),
      showComments && React.createElement('div', { className: 'comment-section' },
        post.comments?.map((c, i) => React.createElement('div', { key: i, className: 'comment-item' },
          React.createElement('div', { className: 'comment-author' }, c.uid),
          React.createElement('div', null, c.text)
        )),
        React.createElement('div', { className: 'row', style: { marginTop:12 }},
          React.createElement('input', { placeholder: 'Comment...', value: commentText, onInput: e => setCommentText(e.target.value), onKeyPress: e => e.key === 'Enter' && submitComment() }),
          React.createElement('button', { className: 'btn', onClick: submitComment, style: { padding:'8px 16px' }}, '‚û§')
        )
      )
    );
  }

  function FriendsPage({ user }) {
    const [requests, setRequests] = useState([]);
    const [friends, setFriends] = useState([]);

    useEffect(() => {
      (async () => {
        const reqs = await getFriendRequests(user.uid);
        const frds = await getFriends(user.uid);
        setRequests(reqs);
        setFriends(frds);
      })();
    }, [user.uid]);

    async function accept(req) {
      await acceptFriendRequest(req.id);
      setRequests(requests.filter(r => r.id !== req.id));
      const frds = await getFriends(user.uid);
      setFriends(frds);
    }

    async function decline(req) {
      await declineFriendRequest(req.id);
      setRequests(requests.filter(r => r.id !== req.id));
    }

    return React.createElement('div', null,
      React.createElement('div', { className: 'card' },
        React.createElement('h3', { style: { marginBottom:16 }}, `Requests (${requests.length})`),
        requests.length === 0 && React.createElement('div', { className: 'small' }, 'No requests'),
        requests.map(req => React.createElement(FriendRequestCard, { key: req.id, request: req, onAccept: () => accept(req), onDecline: () => decline(req) }))
      ),
      React.createElement('div', { className: 'card' },
        React.createElement('h3', { style: { marginBottom:16 }}, `Friends (${friends.length})`),
        friends.length === 0 && React.createElement('div', { className: 'empty-state' },
          React.createElement('div', { className: 'empty-icon' }, 'üë•'),
          React.createElement('div', null, 'No friends yet')
        )
      )
    );
  }

  function FriendRequestCard({ request, onAccept, onDecline }) {
    const [requester, setRequester] = useState(null);
    useEffect(() => {
      (async () => {
        const prof = await getUserProfile(request.requester);
        setRequester(prof);
      })();
    }, [request.requester]);

    if (!requester) return null;

    return React.createElement('div', { className: 'friend-card' },
      React.createElement('div', { className: 'row' },
        React.createElement('img', { src: requester.avatarUrl || 'https.via.placeholder.com/40', className: 'avatar-lg' }),
        React.createElement('div', null,
          React.createElement('div', { style: { fontWeight:600 }}, requester.displayName),
          React.createElement('div', { className: 'small' }, requester.email)
        )
      ),
      React.createElement('div', { className: 'row', style: { gap:8 }},
        React.createElement('button', { className: 'btn', onClick: onAccept }, 'Accept'),
        React.createElement('button', { className: 'btn-ghost', onClick: onDecline }, 'Decline')
      )
    );
  }

  // MODIFIED ProfilePage function
  function ProfilePage({ uid, currentUser }) {
    const [profile, setProfile] = useState(null);
    const [tab, setTab] = useState('posts');
    const [isUploading, setIsUploading] = useState(false);
    const owner = !uid || (currentUser && uid === currentUser.uid);
    const avatarInputRef = useRef(null);
    const coverInputRef = useRef(null);

    useEffect(() => {
      (async () => {
        const p = await getUserProfile(uid || currentUser?.uid);
        setProfile(p);
      })();
    }, [uid, currentUser]);

    async function sendRequest() {
      if (!currentUser) return;
      await sendFriendRequest(currentUser.uid, uid);
      alert('‚úÖ Request sent!');
    }

    async function handleFileUpload(e, type) {
      const file = e.target.files?.[0];
      if (!file || !owner) return;
      setIsUploading(true);
      try {
        const res = await uploadToCloudinary(file);
        const url = res.secure_url;
        const key = type === 'avatar' ? 'avatarUrl' : 'coverUrl';
        await updateDoc(doc(db, 'users', currentUser.uid), { [key]: url });
        setProfile(p => ({ ...p, [key]: url }));
      } catch (err) {
        console.error('Upload failed', err);
        alert('‚ùå Upload failed');
      } finally {
        setIsUploading(false);
        // Reset file input
        if (e.target) e.target.value = null;
      }
    }

    if (!profile) return React.createElement('div', { className: 'card' }, 'Loading...');

    return React.createElement('div', null,
      // Hidden file inputs
      owner && React.createElement('input', { 
        type: 'file', 
        ref: avatarInputRef, 
        style: { display: 'none' }, 
        accept: 'image/*', 
        onChange: (e) => handleFileUpload(e, 'avatar') 
      }),
      owner && React.createElement('input', { 
        type: 'file', 
        ref: coverInputRef, 
        style: { display: 'none' }, 
        accept: 'image/*', 
        onChange: (e) => handleFileUpload(e, 'cover') 
      }),
      
      React.createElement('div', { className: 'card', style: { padding:0, overflow:'hidden' }},
        React.createElement('div', { style: { position: 'relative' }}, // Wrapper for cover
          profile.coverUrl ? React.createElement('img', { src: profile.coverUrl, className: 'cover' }) : React.createElement('div', { className: 'cover' }),
          owner && React.createElement('button', { 
            className: 'btn-ghost', 
            style: { position: 'absolute', bottom: 12, right: 12, background: 'rgba(255,255,255,0.8)' },
            onClick: () => coverInputRef.current?.click(),
            disabled: isUploading
          }, 'Edit Cover')
        ),
        React.createElement('div', { style: { padding:20, marginTop:-50 }},
          React.createElement('div', { className: 'row', style: { justifyContent:'space-between', alignItems:'flex-end' }},
            React.createElement('img', { 
              src: profile.avatarUrl || 'https://via.placeholder.com/150', 
              className: 'avatar-lg', 
              style: { width:80, height:80, border:'5px solid var(--card)', cursor: owner ? 'pointer' : 'default' },
              onClick: owner ? () => avatarInputRef.current?.click() : undefined
            }),
            owner ? 
              React.createElement('button', { 
                className: 'btn-ghost', 
                onClick: () => avatarInputRef.current?.click(),
                disabled: isUploading
              }, isUploading ? 'Uploading...' : 'Edit Profile') : 
              React.createElement('button', { className: 'btn', onClick: sendRequest }, 'Add Friend')
          ),
          React.createElement('div', { style: { marginTop:16 }},
            React.createElement('h2', null, 
              profile.displayName, 
              profile.verified && React.createElement('span', { 
                title: 'Verified', 
                style: { marginLeft: 6, verticalAlign: 'middle' }, 
                dangerouslySetInnerHTML: { 
                  __html: '<svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:#1D9BF0" xmlns="http://www.w3.org/2000/svg"><path d="M22.5 12.5c0-.9-.3-1.7-.8-2.4.3-.8.4-1.6.2-2.4-.2-.8-.7-1.5-1.3-2-.6-.5-1.4-.8-2.2-.9-.3-.7-.8-1.4-1.5-1.9-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7.5-1.2 1.2-1.5 1.9-.8.1-1.6.4-2.2.9-.6.5-1.1 1.2-1.3 2-.2.8-.1 1.6.2 2.4-.5.7-.8 1.5-.8 2.4s.3 1.7.8 2.4c-.3.8-.4 1.6-.2 2.4.2.8.7 1.5 1.3 2 .6.5 1.4.8 2.2.9.3.7.8 1.4 1.5 1.9.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7-.5 1.2-1.2 1.5-1.9.8-.1 1.6-.4 2.2-.9.6-.5 1.1 1.2-1.3 2 .2-.8.1-1.6-.2-2.4.5-.7.8-1.5.8-2.4z"/><path fill="#fff" d="M10.8 14.9l-2.8-2.8 1.2-1.2 1.6 1.6 3.7-4 1.2 1.1z"/></svg>' 
                }
              })
            ),
            React.createElement('div', { className: 'small' }, profile.email),
            profile.status && React.createElement('div', { style: { marginTop:12, padding:12, background:'var(--hover)', borderRadius:8, fontStyle:'italic' }}, profile.status)
          )
        ),
        React.createElement('div', { className: 'tabs' },
          React.createElement('div', { className: `tab ${tab === 'posts' ? 'active' : ''}`, onClick: () => setTab('posts') }, 'Posts'),
          React.createElement('div', { className: `tab ${tab === 'about' ? 'active' : ''}`, onClick: () => setTab('about') }, 'About')
        )
      ),
      tab === 'posts' && React.createElement('div', { className: 'empty-state' },
        React.createElement('div', { className: 'empty-icon' }, 'üìù'),
        React.createElement('div', null, 'No posts')
      ),
      tab === 'about' && React.createElement('div', { className: 'card' },
        React.createElement('h4', null, 'About'),
        React.createElement('div', { className: 'small' }, 'Email: ', profile.email)
      )
    );
  }

  function MessagesPage() {
    return React.createElement('div', { className: 'card' },
      React.createElement('h3', null, 'Messages'),
      React.createElement('div', { className: 'empty-state' },
        React.createElement('div', { className: 'empty-icon' }, 'üí¨'),
        React.createElement('div', null, 'No messages')
      )
    );
  }

  function SettingsPage({ lang, setLang, theme, setTheme }) {
    return React.createElement('div', null,
      React.createElement('div', { className: 'card' },
        React.createElement('h3', { style: { marginBottom:20 }}, 'Settings'),
        React.createElement('div', { className: 'col' },
          React.createElement('label', { className: 'small' }, 'Language'),
          React.createElement('select', { value: lang, onChange: e => setLang(e.target.value) },
            React.createElement('option', { value: 'en' }, 'English'),
            React.createElement('option', { value: 'yo' }, 'Yoruba'),
            React.createElement('option', { value: 'pt' }, 'Portuguese')
        ),
        React.createElement('div', { className: 'row', style: { alignItems:'center', justifyContent:'space-between', marginTop:16 } },
          React.createElement('span', null, 'Dark Mode'),
          React.createElement('button', { className: 'btn-ghost', onClick: () => setTheme(theme === 'light' ? 'dark' : 'light') }, theme === 'light' ? 'üåû Light' : 'üåô Dark')
        ),
        React.createElement('button', { className: 'btn', onClick: async () => { await signOut(auth); window.location.reload(); }, style: { marginTop:20, background:'#fa3e3e' }}, 'Logout')
        )
      ),
      React.createElement('div', { className: 'card' },
        React.createElement('h4', null, 'Help & Support'),
        React.createElement('p', { className: 'small', style: { marginTop:12 }}, 'Contact us:'),
        React.createElement('a', { href: 'mailto:spaceplatformapp@gmail.com', style: { color:'var(--primary)', fontWeight:600, fontSize:15 }}, 'spaceplatformapp@gmail.com')
      )
    );
  }

  function AdminPage() {
    const [users, setUsers] = useState([]);
    
    useEffect(() => {
      (async () => {
        const q = query(collection(db,'users'), orderBy('createdAt','desc'));
        const snap = await getDocs(q);
        setUsers(snap.docs.map(d => ({ id: d.id, ...d.data() })));
      })();
    }, []);
    
    async function toggleVerified(uid, current) {
      await updateDoc(doc(db,'users',uid), { verified: !current });
      const p = await getUserProfile(uid);
      setUsers(u => u.map(x => x.id === uid ? p : x));
    }
    
    return React.createElement('div', { className: 'card' },
      React.createElement('h3', { style: { marginBottom:20 }}, 'Admin Panel'),
      React.createElement('p', { className: 'small', style: { marginBottom:16 }}, 'Manage verifications'),
      users.map(u => React.createElement('div', { key: u.id, className: 'friend-card' },
        React.createElement('div', { className: 'row' },
          u.avatarUrl && React.createElement('img', { src: u.avatarUrl, className: 'avatar' }),
          React.createElement('div', null,
            React.createElement('div', { style: { fontWeight:600 }}, 
              u.displayName, 
              u.verified && React.createElement('span', { 
                title: 'Verified', 
                style: { marginLeft: 6, verticalAlign: 'middle' }, 
                dangerouslySetInnerHTML: { 
                  __html: '<svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:#1D9BF0" xmlns="http://www.w3.org/2000/svg"><path d="M22.5 12.5c0-.9-.3-1.7-.8-2.4.3-.8.4-1.6.2-2.4-.2-.8-.7-1.5-1.3-2-.6-.5-1.4-.8-2.2-.9-.3-.7-.8-1.4-1.5-1.9-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7-.5-1.5-.8-2.4-.8s-1.7.3-2.4.8c-.7.5-1.2 1.2-1.5 1.9-.8.1-1.6.4-2.2.9-.6.5-1.1 1.2-1.3 2-.2.8-.1 1.6.2 2.4-.5.7-.8 1.5-.8 2.4s.3 1.7.8 2.4c-.3.8-.4 1.6-.2 2.4.2.8.7 1.5 1.3 2 .6.5 1.4.8 2.2.9.3.7.8 1.4 1.5 1.9.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7.5 1.5.8 2.4.8s1.7-.3 2.4-.8c.7-.5 1.2-1.2 1.5-1.9.8-.1 1.6-.4 2.2-.9.6-.5 1.1 1.2-1.3 2 .2-.8.1-1.6-.2-2.4.5-.7.8-1.5.8-2.4z"/><path fill="#fff" d="M10.8 14.9l-2.8-2.8 1.2-1.2 1.6 1.6 3.7-4 1.2 1.1z"/></svg>' 
                }
              })
            ),
            React.createElement('div', { className: 'small' }, u.email)
          )
        ),
        React.createElement('button', { className: u.verified ? 'btn-ghost' : 'btn', onClick: () => toggleVerified(u.id, u.verified), style: u.verified ? { color:'#fa3e3e' } : {}}, u.verified ? 'Remove ‚úî' : 'Verify')
      ))
    );
  }

  const container = document.getElementById('root');
  createRoot(container).render(React.createElement(App));

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW failed', err));
    });
  }
  </script>
</body>
</html>
